= filebeat =

常用配置文档:

* filebeat https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-options.html
* Output https://www.elastic.co/guide/en/beats/filebeat/current/configuring-output.html
* JSON https://www.elastic.co/guide/en/beats/filebeat/current/decode-json-fields.html
* APIs https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html

开启 UDP 收日志，以 JSON 格式解码原始日志，输出到控制台：

{{{yml
processors:
- decode_json_fields:
    fields:
    - message

filebeat.inputs:
- type: udp
  host: :8000

output.console:
  pretty: true
}}}


开启 UDP 收日志，清理自带的一些字段，以 JSON 格式解码原始日志到顶层，清理原始日志，输出到控制台：

{{{yml
processors:

- drop_fields:
    fields:
    - input
    - agent
    - host
    - ecs
    - log

- decode_json_fields:
    target: ""
    fields:
    - message

- drop_fields:
    fields:
    - message


filebeat.inputs:
- type: udp
  host: :8000


output.console:
  pretty: true
}}}


开启 UDP 收日志，清理自带的一些字段，以 JSON 格式解码原始日志到顶层，清理原始日志，输出到 elasticsearch：

{{{yml
processors:

- drop_fields:
    fields:
    - input
    - agent
    - host
    - ecs
    - log

- decode_json_fields:
    target: ""
    fields:
    - message

- drop_fields:
    fields:
    - message


filebeat.inputs:
- type: udp
  host: :8000


output.elasticsearch:
  hosts:
  - elasticsearch
  - elasticsearch-2:9200
  - http://elasticsearch-3:9200
  index: "xxx-%{+yyyy.MM.dd}"


setup:
  ilm.enabled: false
  template:
    name: q
    pattern: q-*  
}}}

注意需要自定义 `setup.template`，关闭 `setup.ilm.enabled`。然而 `output.elasticsearch.index` 又可以任意发挥。
